---
import Layout from "../../layouts/Layout.astro";

import Papa from "papaparse";
import fs from "fs";
import { marked } from "marked";

export async function getStaticPaths() {
  const csvText = fs.readFileSync("public/post_export.csv", "utf-8");
  const allPosts = Papa.parse(csvText, { header: true }).data;

  return allPosts
    .filter((post: any) => post["is page"] === "False")
    .filter((post: any) => post["publish"] === "True")
    .map((post: any) => {
      post["all tags"] = JSON.parse(post["all tags"]);
      post["content"] = marked(post["content"]);
      post["published date"] = new Date(post["published date"]);

      return {
        params: { slug: `${post.slug}` },
        props: { post: post },
      };
    });
}

interface Props {
  post: any;
}

// const { slug } = Astro.params;
const { post } = Astro.props;
---

<Layout pageTitle={post.title}>
  <h1>{post.title}</h1>
  <p>
    <i>
      <time datetime={post["published date"].toISOString()}>
        {
          post["published date"].toLocaleDateString("en-US", {
            year: "numeric",
            month: "short",
            day: "numeric",
          })
        }
      </time>
    </i>
  </p>

  <article set:html={post.content} />

  <!-- {
    Object.keys(post).map((key) => (
      <p>
        <strong>{key}</strong>: {JSON.stringify(post[key])}
      </p>
    ))
  } -->
</Layout>
