---
import Layout from "../../layouts/Layout.astro";

import Papa from "papaparse";
import fs from "fs";

const csvText = fs.readFileSync("public/post_export.csv", "utf-8");
const allPosts = Papa.parse(csvText, { header: true })
  .data.filter((post: any) => post["is page"] === "False")
  .map((post: any) => {
    post["published date"] = new Date(post["published date"]);

    return post;
  })
  .sort((a: any, b: any) => b["published date"] - a["published date"]);
---

<Layout pageTitle={"Blog"}>
  <h1 id="blog">Blog</h1>
  <p></p>

  <ul class="embedded blog-posts">
    {
      allPosts
        .filter((st: any) => st.slug)
        .map((st: any) => (
          <li>
            <span>
              <i>
                <time datetime={st["published date"].toISOString()}>
                  {st["published date"].toLocaleDateString("en-US", {
                    year: "numeric",
                    month: "short",
                    day: "numeric",
                  })}
                </time>
              </i>
            </span>
            <a href={st.slug}>{st.title}</a>
          </li>
        ))
    }
  </ul>
</Layout>
